#!/bin/bash
set -eu -o pipefail

##
# Downloads free instrument samples from various sources.
#

APP=Gen.js

##
# Freesound
# https://freesound.org/
#
# Samples:
#
# - Piano
#
FREESOUND_URL=https://freesound.org/apiv2
FREESOUND_ID=aQpk7KYoJXsJazCIgsA3
FREESOUND_SECRET=7dQJ1PMvSu2XmYqriw25PN3kvbDdnBAaebQ5RPzs

# Open freesound.org to generate an auth code for the logged in user.
read -p "$APP requires authorization to download from Freesound. Press enter to continue..."
open "$FREESOUND_URL/oauth2/authorize/?client_id=$FREESOUND_ID&response_type=code"

# Prompt user for their auth code.
echo "Enter authorization code:"
read auth_code

# Get an access token for subsequent requests.
auth_params="client_id=$FREESOUND_ID&client_secret=$FREESOUND_SECRET&grant_type=authorization_code&code=$auth_code"
access_token=$(curl -sb -H "Content-Type: application/json" -d $auth_params $FREESOUND_URL/oauth2/access_token/  | jq -r ".access_token")
auth_header="Authorization: Bearer $access_token"

# Download sample packs using access token.

# Piano
curl -H $auth_header -o /tmp/piano.zip "$FREESOUND_URL/packs/9133/download/"
unzip /tmp/piano.zip -d ./src/samples/piano/files
rm /tmp/piano.zip

##
# Philharmonia Orchestra
# https://www.philharmonia.co.uk/explore/sound_samples
#
# Samples:
#
# - Cello
# - Flute
# - Viola
# - Violin
#
for inst in cello flute viola violin
do
  curl -o /tmp/$inst.zip https://www.philharmonia.co.uk/assets/audio/samples/$inst/$inst.zip
  unzip /tmp/$inst.zip -d ./src/samples/$inst/files
  rm /tmp/$inst.zip
done

<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">
<script src="https://unpkg.com/tuplet"></script>

<title data-react-helmet="true">JavaScript | Tuplet</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="JavaScript | Tuplet"><meta data-react-helmet="true" name="description" content="- https://github.com/markerikson/react-redux-links/blob/master/README.md#learning-core-javascript-es5"><meta data-react-helmet="true" property="og:description" content="- https://github.com/markerikson/react-redux-links/blob/master/README.md#learning-core-javascript-es5"><meta data-react-helmet="true" property="og:url" content="https://tuplet.js.org/book/primers/javascript">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png">


<link rel="stylesheet" href="/styles.d2235b46.css">


<link rel="preload" href="/styles.92ca4bb3.js" as="script">

<link rel="preload" href="/runtime~main.8df9937f.js" as="script">

<link rel="preload" href="/main.c6c0ba12.js" as="script">

<link rel="preload" href="/1.be24b235.js" as="script">

<link rel="preload" href="/2.fb898079.js" as="script">

<link rel="preload" href="/1be78505.f6441ca7.js" as="script">

<link rel="preload" href="/17eab23a.3e166dc5.js" as="script">

<link rel="preload" href="/17896441.d0d0299b.js" as="script">

<link rel="preload" href="/c29df622.c495703a.js" as="script">

</head>
<body>

<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/tuplet.svg" alt="Site Logo"><strong class="navbar__title">Tuplet</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/book/introduction">Book</a><a class="navbar__item navbar__link" href="/book/api/index">API</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/meleyal/tuplet" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/tuplet.svg" alt="Site Logo"><strong class="navbar__title">Tuplet</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/book/introduction">Book</a></li><li class="menu__list-item"><a class="menu__link" href="/book/api/index">API</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/meleyal/tuplet" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="#!">Welcome</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/book/introduction">Introduction</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Primers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/book/primers/generative">Generative</a></li><li class="menu__list-item"><a class="menu__link" href="/book/primers/music">Music</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/book/primers/javascript">JavaScript</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Music</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/book/music/notes">Notes</a></li><li class="menu__list-item"><a class="menu__link" href="/book/music/scales">Scales</a></li><li class="menu__list-item"><a class="menu__link" href="/book/music/timing">Timing</a></li><li class="menu__list-item"><a class="menu__link" href="/book/music/sequencing">Sequencing</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Generative</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/book/generative/repetition">Repetition</a></li><li class="menu__list-item"><a class="menu__link" href="/book/generative/randomness">Randomness</a></li><li class="menu__list-item"><a class="menu__link" href="/book/generative/probability">Probability</a></li><li class="menu__list-item"><a class="menu__link" href="/book/generative/grammars">Grammars</a></li><li class="menu__list-item"><a class="menu__link" href="/book/generative/recursion">Recursion</a></li><li class="menu__list-item"><a class="menu__link" href="/book/generative/evolution">Evolution</a></li><li class="menu__list-item"><a class="menu__link" href="/book/generative/machine-learning">Machine Learning</a></li><li class="menu__list-item"><a class="menu__link" href="/book/generative/sonification">Sonification</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Course</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/book/course/outline">Course Outline</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Examples</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/book/examples/scales">Scales</a></li><li class="menu__list-item"><a class="menu__link" href="/book/examples/phasing">Phasing</a></li><li class="menu__list-item"><a class="menu__link" href="/book/examples/canon">Canon</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/book/api/index">API Reference</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">JavaScript</h1></header><div class="markdown"><ul><li><a href="https://github.com/markerikson/react-redux-links/blob/master/README.md#learning-core-javascript-es5">https://github.com/markerikson/react-redux-links/blob/master/README.md#learning-core-javascript-es5</a></li></ul><p>This article is a general introduction to the Web Audio API aimed at web
developers who are interested in extending their skills to work with audio and
music applications.</p><p>We start by defining what the Web Audio API is and where it came from, then move
on to cover two of its key concepts that may be unfamiliar to web developers:
graphs and timing. Along the way we&#x27;ll get a feel for the API and what it can
do.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="background"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#background" title="Direct link to heading">#</a>Background</h2><p>The Web Audio API is a set of APIs for generating and processing audio in the
browser. It&#x27;s designed by the
<a href="https://www.w3.org/2011/audio/">W3C Audio Working Group</a>, steered by Google,
Mozilla, and the BBC, and chartered to &quot;add advanced sound and music synthesis
capabilities to the Open Web Platform.&quot;</p><p>It has been in development
<a href="https://www.w3.org/TR/2011/WD-webaudio-20111215/">since 2011</a>, with the spec
recently reaching v1.0 (with
<a href="https://github.com/WebAudio/web-audio-api-v2">v2.0 in the works</a>) and becoming
a <a href="https://www.w3.org/TR/webaudio/">W3C Candidate Recomendation</a>. Despite its
candiditate status, it&#x27;s already well supported in browsers,
<a href="https://caniuse.com/#feat=audio-api">reaching 94% of users</a> at time of writing.</p><p>Common use-cases cited for the Web Audio API are to bring music composition and
audio editing tools (e.g. Ableton Live, Logic Pro) to the browser, as well as
enabling real-time audio for games and VR. Beyond these obvious applications,
bringing sound to the mix opens up another dimension for building a richer, more
sensory web.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="the-web-audio-api"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-web-audio-api" title="Direct link to heading">#</a>The Web Audio API</h2><p>The Web Audio API itself is relatively small, and is covered comprehensively by
the
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API">MDN Web Docs</a>,
the go-to source for understanding everything the API can do.</p><p>Rather than repeat the documentation here, we&#x27;ll instead focus on the two
aspects of working with the API that are most different from traditional web
development, namely the audio graph and the timing model. We&#x27;ll cover just
enough of the API to get up and running creating our own bleeps and bloops.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="graphs--nodes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#graphs--nodes" title="Direct link to heading">#</a>Graphs &amp; Nodes</h2><p>As web developers, we&#x27;re used to working with the DOM, a tree data structure
representing a hierarchy of nodes that we traverse via parent, sibling and child
relationships. The Web Audio API, on the other hand (and audio apps in general),
organizes nodes in a <em>graph</em> data structure.</p><p>[ILLUSTRATION]</p><p><em>Source</em> nodes generate signals and are the inputs of our system. These signals
are routed through <em>effect</em> nodes to modify them in various ways. Everything
ends up at a single <em>destination</em> node, i.e. your speakers, producing the
audible output of our system. This is digital signal processing 101.</p><p>It&#x27;s worth taking a moment to understand the fundamental differences between
tree and graph data structures.
<a href="https://en.wikipedia.org/wiki/Graph_(abstract_data_type)">Graph theory</a> is
it&#x27;s own rich topic, but a key point to note is that a graph is not a heirarchy,
but is instead like a flow chart or electrical circuit. Each node is &#x27;equal&#x27; and
can be connected to any (and many) other nodes, and connections can be circular
(in fact this is essential to produce certain types of effects).</p><p>If we think about it, this is not such a new concept. We build pages (nodes)
which we link together to form websites and apps (graphs), which together form
the internet, itself a graph of servers, routers, etc.</p><p>You might come across graphs described in more technical terms. Graph nodes are
also know as <em>vertices</em>, with the connections between them known as <em>edges</em>.
Traversing a graph is done by following its edges. A graph data structure
generally has ways to find which vertices are connected (either directly or via
other vertices), and insert and remove vertices and edges at given points in the
graph. Specifically, the Web Audio API uses a <em>directed graph</em>, that is, the
signals flow in a defined direction.</p><p>A big part of working with the Web Audio API involves creating nodes and making
sure they are wired up correctly in our graph. So let&#x27;s see how this works...</p><p>### Creating Our Graph</p><p>Our graph exists in an <code>AudioContext</code>. Everything we do via the Web Audio API
happens in this context, similar to how a <code>&lt;canvas&gt;</code> element creates its own
environment for drawing. We&#x27;ll generally only create a single <code>AudioContext</code> per
app and use its factory methods to create the nodes of our graph:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" class="runButton_3F96">Run</button><div class="prism-code language-js codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AudioContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> osc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createOscillator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> vol </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createGain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">osc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vol</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">vol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">destination</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div></div></div></div></div><p>Here we create an <code>AudioContext</code>, and from it create two different node types.
an <code>OscillatorNode</code>, a type of <em>source</em> node, and a <code>GainNode</code>, a type of
<em>effect</em> node (we&#x27;ll cover what these nodes actually do shortly). We connect the
<code>OscillatorNode</code> to the <code>GainNode</code>, and the <code>GainNode</code> to the <em>destination</em> node
of the <code>AudioContext</code> i.e. our speakers. Our graph looks as follows (rendered in
Chrome with the <a href="https://google.github.io/audion/">Web Audio Inspector</a>).</p><p><img src="/img/primers/javascript/basic-graph.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="nodes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#nodes" title="Direct link to heading">#</a>Nodes</h2><p>Everything we create in our graph is a node. All nodes implement the
<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioNode"><code>AudioNode</code></a>
interface, with additional properties and methods specific to their type.</p><p>A node&#x27;s properties can be get and set as you&#x27;d expect, but with an additional
super-power: they implement the
<a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioParam"><code>AudioParam</code></a>
interface, meaning changes to them can be scheduled over time:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" class="runButton_3F96">Run</button><div class="prism-code language-js codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AudioContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> osc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createOscillator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Set frequency now</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">osc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">frequency</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">440</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Change frequency in 1 second</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">oscillator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">frequency</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setValueAtTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">880</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentTime</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div></div></div></div></div><p>Nodes all implement the <code>connect()</code> method, which is how you connect the output
of one node to the input of others. This chaining is what creates our graph.</p><p>Nodes themselves can be grouped into two types: Source Nodes and Effect Nodes.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="source-nodes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#source-nodes" title="Direct link to heading">#</a>Source Nodes</h3><p>Source nodes are anything that produce an audio signal and are the inputs of our
system. There are several types of source node, but we&#x27;ll cover just the two
most common here:</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/OscillatorNode"><code>OscillatorNode</code></a>
– for synthesizing our own sounds.</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/AudioBufferSourceNode"><code>AudioBufferSourceNode</code></a>
– for playing back recorded sounds (samples).</li></ul><p>All source nodes have a <code>start()</code> and <code>stop()</code> method, which as you might guess,
start and stop them producing their audio signal.</p><p><strong>Note:</strong> Source nodes are single use only, or &#x27;fire and forget&#x27;. Once a node
has stopped (either by manually calling <code>stop()</code>, or by reaching the end of the
sample it was playing), it cannot be restarted. In creating a piano instrument,
our instinct might be to create 88 nodes, one for each key. Instead, we actually
need to create a new node each time a key is pressed. In this way, our audio
graph is not something fixed that we define ahead of time, but is instead a
dynamic structure that changes as new nodes are created and discarded. Source
nodes are intentionally cheap to create and stopped nodes are automatically
garbage-collected for us.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="oscillatornode"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#oscillatornode" title="Direct link to heading">#</a>OscillatorNode</h4><p>To synthesize our own sounds, we&#x27;d use an <code>OscillatorNode</code>. This produces a
waveform (sine, square, triangle, etc.) oscillating at a given frequency
(specified in hertz). By combining different types of oscillators and effects,
we can produce an infinite range of sounds.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" class="runButton_3F96">Run</button><div class="prism-code language-js codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AudioContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> bass </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createOscillator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">bass</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;sine&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">bass</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">frequency</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">220</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">bass</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">frequency</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">linearRampToValueAtTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">880</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentTime</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hi </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createOscillator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">hi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;square&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">hi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">frequency</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">660</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">hi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">frequency</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">linearRampToValueAtTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">880</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentTime</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">bass</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">destination</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">hi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">destination</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">bass</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">hi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="audiobuffersourcenode"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#audiobuffersourcenode" title="Direct link to heading">#</a>AudioBufferSourceNode</h4><p>To play back recorded sounds (samples), we&#x27;d use an <code>AudioBufferSourceNode</code>.
This node is responsible for playing back and controlling the sample, but the
sample itself is stored in an <code>AudioBuffer</code>. In this way we can load a sample
once, and use it many times.</p><p>Loading a sample is a two step process. We first need to fetch it over the
network, then decode it into a format that <code>AudioBuffer</code> understands.</p><p>The whole process of loading, decoding, and finally playing back a sample looks
as follows:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" class="runButton_3F96">Run</button><div class="prism-code language-js codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AudioContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;http://example.com/meow.mp3&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> arrayBuffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">arrayBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> audioBuffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">decodeAudioData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arrayBuffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sourceNode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createBufferSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">sourceNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">buffer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> audioBuffer</span></div><div class="token-line" style="color:#393A34"><span class="token plain">sourceNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">destination</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">sourceNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="effect-nodes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#effect-nodes" title="Direct link to heading">#</a>Effect Nodes</h3><p>We can route an audio signal (coming from a source node) through a wide range of
effect nodes. These modify the incoming signal in some way, producing a new
signal as output. The Web Audio API defines some basic primitives, which can be
combined to create all sorts of effects. The most common ones are:</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/GainNode"><code>GainNode</code></a> –
adjusts the volume of a signal. By applying this over time we can also model
ADSR envelopes (e.g. if a sound starts abruptly or fades in slowly).</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/BiquadFilterNode"><code>BiquadFilterNode</code></a> -
cut or boost certain frequencies of a signal</li><li>ConvolverNode - apply reverb to a signal so it sounds like it&#x27;s in a certain
physical space e.g. a small room or large hall.</li><li>DelayNode - apply a delay the the outgoing signal, used for all sorts of
effects from echoes to phasing.</li><li>DynamicsCompressorNode – applies compression to a signal to control its
dynamic range (e.g. to avoid distortion)</li><li>WaveShaperNode – applies distortion to the signal.</li><li>PannerNode – places the audio in the stereo field (i.e. to the left or right
in stereo output).</li></ul><p>### Destination Node</p><p>The detination node is the final node in the chain and represents our audio
output device (i.e. our sound card). This is provided for us as the
<code>destination</code> node of our AudioContext. In addition, there&#x27;s also an
offlineAudioContext with its own destination if we want to render our audio to
disk, for example.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="timing-model"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#timing-model" title="Direct link to heading">#</a>Timing Model</h2><p>To understand the timing model, we need to understand under the hood, control
thread = your code, rendering thread = where audio is actually computed.</p><p>Timing: has it&#x27;s own internal clock. Separate from JS clock. JS clock can be
thought of as lazy/relative/imprecise. Usually we&#x27;d schedule a callback in
2000ms. JS will schedule this and run when it&#x27;s done with other tasks, in
roughly 2 seconds.</p><p>Web Audio clock is absolute time. Precise. Seconds, not milliseconds! Relative
to the current time.</p><p>ILLUSTRATION?</p><p>Current time is defined by the AudioContext. It starts counting up from the
moment the AudioContext is created. We can&#x27;t change it, we can only get it and
schedule things relative to it:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_3RXF"><button type="button" class="runButton_3F96">Run</button><div class="prism-code language-js codeBlock_1wn8"><div class="codeBlockLines_3HrO" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AudioContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentTime</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; 0.1234</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span></div></div></div></div></div><p>As you can see, the Web Audio API doesn&#x27;t give us much to work with here. We
need to invent our own timing abstraction to work with beats, bars, time
signatures etc. But that&#x27;s for a future article!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="aside-autoplay-policy"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#aside-autoplay-policy" title="Direct link to heading">#</a>Aside: Autoplay Policy</h2><p>Needs interaction. Needs some hijinx.</p><ul><li>Chrome: <code>chrome://flags/#autoplay-policy</code> – no longer working as of v76</li><li>Firefox: enabled by default?</li><li>Safari: ?</li><li>Edge: ?</li></ul><p>Can be allowed for specific domains:</p><ul><li>Chrome: chrome://settings/content/sound</li></ul><p>References:</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/Media/Autoplay_guide#Autoplay_using_the_Web_Audio_API">https://developer.mozilla.org/en-US/docs/Web/Media/Autoplay_guide#Autoplay_using_the_Web_Audio_API</a></li><li><a href="https://developers.google.com/web/updates/2017/09/autoplay-policy-changes#webaudio">https://developers.google.com/web/updates/2017/09/autoplay-policy-changes#webaudio</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="conclusion"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#conclusion" title="Direct link to heading">#</a>Conclusion</h2><p>The WAA is a well defined and adopted/supported technology that&#x27;s actively
developed. It is and will continue to enable a whole range of previously
native-tethered apps to move to the web.</p><p>The WAA provides only the basic primitives. Because it&#x27;s use-cases are wide.
Depending on what we want to do, we have to build our own abstractions. There
are already a range of libraries for music, game audio, VR?, machine learning.</p><p>If we understand two basic concepts: graph/nodes and timing model, we have a
good foundation for working at a higher level and make cool stuff.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="further-reading"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#further-reading" title="Direct link to heading">#</a>Further Reading</h2><ul><li><a href="https://teropa.info/blog/2016/07/28/javascript-systems-music.html">JavaScript Systems Music</a></li><li><a href="http://teropa.info/blog/2016/08/19/what-is-the-web-audio-api.html">What Is the Web Audio API?</a></li><li><a href="https://medium.com/@metalex9/making-generative-music-in-the-browser-bfb552a26b0b">Making Generative Music in the Browser</a></li></ul></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/book/primers/music"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« Music</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/book/music/notes"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">Notes »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#background" class="contents__link">Background</a></li><li><a href="#the-web-audio-api" class="contents__link">The Web Audio API</a></li><li><a href="#graphs--nodes" class="contents__link">Graphs &amp; Nodes</a></li><li><a href="#nodes" class="contents__link">Nodes</a><ul><li><a href="#source-nodes" class="contents__link">Source Nodes</a></li><li><a href="#effect-nodes" class="contents__link">Effect Nodes</a></li></ul></li><li><a href="#timing-model" class="contents__link">Timing Model</a></li><li><a href="#aside-autoplay-policy" class="contents__link">Aside: Autoplay Policy</a></li><li><a href="#conclusion" class="contents__link">Conclusion</a></li><li><a href="#further-reading" class="contents__link">Further Reading</a></li></ul></div></div></div></div></div></main></div></div>
</div>

<script src="/styles.92ca4bb3.js"></script>

<script src="/runtime~main.8df9937f.js"></script>

<script src="/main.c6c0ba12.js"></script>

<script src="/1.be24b235.js"></script>

<script src="/2.fb898079.js"></script>

<script src="/1be78505.f6441ca7.js"></script>

<script src="/17eab23a.3e166dc5.js"></script>

<script src="/17896441.d0d0299b.js"></script>

<script src="/c29df622.c495703a.js"></script>


</body>
</html>